{% extends "base.html" %}
{% load static bootstrap3 i18n %}


{% block css %}
<style>
#map{
  width: 100%;
  height: 600px;
}
th{
  width: 10%;
}
</style>
{% endblock css %}


{% block main %}
<div class="table-reponsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>#</th>
        <td>Content</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th>Pictures</th>
        <td>
          {% for picture in position.pictures.all %}
            <img src="{{picture.file.url}}" alt="{picture.name}}"> 
          {% endfor %}
        </td> 
      </tr>
      <tr>
        <th>Anchor</th>
        <td> 
            <a href="http://{{ request.get_host }}/apicall/{{position.id}}/" target="blank">
              http://{{ request.get_host }}/apicall/{{position.id}}/
            </a>
<pre>&lt;a href='http://{{ request.get_host }}/apicall/{{position.id}}/' target='blank'&gt;
    &lt;img src='{{position.picture.url}}' alt='{{position.myname}}'&gt;
&lt;/a&gt;</pre> 
        </td> 
      </tr>
      <tr>
        <th>onMap</th>
        <td> 
            <div id="map"></div>
        </td> 
      </tr>
    </tbody>
  </table>
</div>
{% endblock main %}


{% block javascript %}

<script>
var markers = [];
var pos, map;

function initMap() {

  map = new google.maps.Map(document.getElementById('map'), {
      zoom: 14,
      center: pos
  });

  bounds = new google.maps.LatLngBounds();

  var locations = [
    {% for picture in position.pictures.all %}
        {id: {{picture.id}}, location: {lat: {{picture.lat}}, lng: {{picture.lng}} }, icon: '{{picture.file.url}}' },
    {% endfor %}
  ];

  for (var i = 0; i < locations.length; i++) {
      pos = locations[i].location;
      var id = locations[i].id;
      var title = locations[i].title;
      var icon = locations[i].icon;


      var marker = new google.maps.Marker({
          map: map,
          position: pos,
          icon: icon,
          id: id
      });

      markers.push(marker);
      bounds.extend(marker.position);
  }
    // console.log("FitBounds function", theme);
  if (locations.length >= 2) {
      map.fitBounds(bounds);
  } else {
      map.panTo(pos);
  }
}
</script>

<script async defer
src="http://ditu.google.cn/maps/api/js?key=AIzaSyD03p1K9oToraWXg-EsjsV7I06xwKaQ1do&callback=initMap">
</script>
{% endblock javascript %}
